/**
*
*   AceGrammar
*   @version: 0.1
*   Transform a grammar specification in JSON format,
*   into an ACE syntax-highlight parser mode
*
*   https://github.com/foo123/ace-grammar
*
**/(function(t,e){var n,i="0.1",s=2,r=4,o=8,h=9,u=16,c=32,a=64,l=128,k=256,p=512,f=33,m=34,g=36,R=40,d=48,y=64,v=128,O=4,E=8,b=16,B=32,T=64,x=128,w=256,A=512,P=1024,q=2048,N=4096,S=8192,z={ONEOF:x,EITHER:x,ALL:w,ALLOF:w,ZEROORONE:A,ZEROORMORE:P,ONEORMORE:q},L={BLOCK:T,"ESCAPED-BLOCK":B,SIMPLE:b,GROUP:N,NGRAM:S,"N-GRAM":S},_=Array.prototype.slice,C=(Array.prototype.splice,Array.prototype.concat,Object.prototype.hasOwnProperty),M=Object.prototype.toString,j=function(t,e){t=t||{};for(var n in e)C.call(e,n)&&(t[n]=e[n]);return t},G=function(t,e){var n=function(){},i=e.constructor;return n.prototype=t.prototype,i.prototype=new n,i.prototype.constructor=i,i.prototype=j(i.prototype,e),i},I=function(t){var n=typeof t,i=M.call(t);return"number"==n||t instanceof Number?s:!0===t||!1===t?r:t&&("string"==n||t instanceof String)?1==t.length?h:o:t&&("[object RegExp]"==i||t instanceof RegExp)?u:t&&("[object Array]"==i||t instanceof Array)?c:t&&"[object Object]"==i?a:null===t?l:e===t?k:p},D=function(t,e){return e||c!=I(t)?[t]:t},K=function(t,e){return t=D(t,e),(e||c!=I(t[0]))&&(t=[t]),t},$=function(t){var e,n=I(t);if(a!=n&&c!=n)return t;var i,s={};for(i in t)C.call(t,i)&&(e=I(t[i]),s[i]=a==e?$(t[i]):c==e?t[i].slice():t[i]);return s},U=function(){var t=_.call(arguments),e=t.length;if(1>e)return null;if(2>e)return $(t[0]);var n,i,s,r,h=t.shift(),u=$(h);for(e--,i=0;e>i;i++)if(n=t.shift())for(s in n)C.call(n,s)&&(C.call(h,s)?(r=I(h[s]),a&~o&r&&(u[s]=U(h[s],n[s]))):u[s]=$(n[s]));return u},F=/([\-\.\*\+\?\^\$\{\}\(\)\|\[\]\/\\])/g,H=function(t,e){return e.length-t.length},W=function(t,e){return o&I(e)&&o&I(t)&&e.length&&e.length<=t.length&&e==t.substr(0,e.length)},Z=function(t,e,i){if(!t||s==I(t))return t;var r=e?e.length||0:0;if(r&&e==t.substr(0,r)){var o,h,u,c="^("+t.substr(r)+")";return i[c]||(o=new RegExp(c),u=new n(o).analyze(),h=u.getPeekChars(),Object.keys(h.peek).length||(h.peek=null),Object.keys(h.negativepeek).length||(h.negativepeek=null),i[c]=[o,h]),i[c]}return t},V=function(t,e){var n,i,s={},r="";for(o==I(e)&&(r=e),n=0,i=t.length;i>n;n++)s[t[n].charAt(0)]=1,t[n]=t[n].replace(F,"\\$1");return[new RegExp("^("+t.sort(H).join("|")+")"+r),{peek:s,negativepeek:null},1]},J=G(Object,{constructor:function(t,e,n,i){this.name=t,this.pattern=e,this.key=n||0,this.type=i||d},name:null,pattern:null,peek:null,type:null,key:0,toString:function(){var t="[";return t+="Matcher: "+this.name,t+=", Type: "+this.type,t+=", Pattern: "+(this.pattern?this.pattern.toString():null),t+="]"},test:function(){return!0},match:function(){return[this.key,this.pattern]}}),Q=G(J,{constructor:function(t,e,n){this.name=t,this.pattern=e,this.type=f,this.key=n||0},test:function(t){return this.pattern==t.charAt(0)},match:function(t,e){e=!1!==e;var n=t.string.charAt(t.pos)||"";return this.pattern==n?(e&&(t.pos+=1),[this.key,n]):!1}}),X=G(J,{constructor:function(t,e,n){this.name=t,this.pattern=e,this.peek={peek:{},negativepeek:null},this.peek.peek[""+e.charAt(0)]=1,this.type=m,this.key=n||0},test:function(t){var e=t.charAt(0);if(this.peek.peek[e]){var n=this.pattern.length,i=t.substr(0,n);if(this.pattern==i)return!0}return!1},match:function(t,e){e=!1!==e;var n=t.pos,i=t.string.charAt(n);if(this.peek.peek[i]){var s=this.pattern.length,r=t.string.substr(n,s);if(this.pattern==r)return e&&(t.pos+=s),[this.key,r]}return!1}}),Y=G(J,{constructor:function(t,e,n){this.name=t,this.pattern=e[0],this.peek=e[1],this.isComposite=e[2]||0,this.type=g,this.key=n||0},isComposite:0,test:function(t){var e=t.charAt(0);if(this.peek.peek&&this.peek.peek[e]||this.peek.negativepeek&&!this.peek.negativepeek[e]){var n=t.match(this.pattern);return!n||n.index>0?!1:!0}return!1},match:function(t,e){e=!1!==e;var n=t.pos,i=t.string.charAt(n);if(this.peek.peek&&this.peek.peek[i]||this.peek.negativepeek&&!this.peek.negativepeek[i]){var s=t.string.slice(n).match(this.pattern);return!s||s.index>0?!1:(e&&(t.pos+=s[this.isComposite].length),[this.key,s])}return!1}}),te=G(J,{constructor:function(t,e,n){this.name=t,this.type=R,this.key=n||0},match:function(t,e){return!1!==e&&(t.pos=t.string.length),[this.key,""]}}),ee=function(t,e,n,i){n=n||0;var u,a=t+"_SimpleMatcher",k=I(e);return s==k?e:(i[a]||(u=r==k?new J(a,e,n):l==k?new te(a,e,n):h==k?new Q(a,e,n):o==k?new X(a,e,n):c==k?new Y(a,e,n):e,i[a]=u),i[a])},ne=G(J,{constructor:function(t,e,n){this.name=t,this.matchers=e,this.type=y,this.useOwnKey=!1!==n},matchers:null,useOwnKey:!0,test:function(t){var e,n,i=this.matchers,s=i.length;for(e=0;s>e;e++)if(n=i[e].test(t))return!0;return!1},match:function(t,e){var n,i,s=this.matchers,r=s.length;for(n=0;r>n;n++)if(i=s[n].match(t,e))return this.useOwnKey?[n,i[1]]:i;return!1}}),ie=function(t,e,n,i,s,r){var o,h,u,a,l,k=!1,p=!1,f=t+"_CompoMatcher";if(!r[f]){if(o=D(e),u=o.length,i)for(a=(u>>1)+1,h=0;a>=h;h++){if(c==I(o[h])||c==I(o[u-1-h])){k=!0;break}if(W(o[h],n)||W(o[u-1-h],n)){p=!0;break}}if(!i||k||p){for(h=0;u>h;h++)o[h]=c==I(o[h])?ie(f+"_"+h,o[h],n,i,s,r):ee(f+"_"+h,Z(o[h],n,s),h,r);l=o.length>1?new ne(f,o):o[0]}else l=ee(f,V(o,i),0,r);r[f]=l}return r[f]},se=G(J,{constructor:function(t,e,n){this.name=t,this.type=v,this.start=new ne(this.name+"_StartMatcher",e,!1),this.pattern=this.start.pattern||null,this.end=n},start:null,end:null,test:function(t){return this.start.test(t)},match:function(t,e){var n=this.start.match(t,e);if(n){var i=this.end[n[0]];return s==I(i)&&(i=new X(this.name+"_EndMatcher",n[1][i+1])),i}return!1}}),re=function(t,e,n,i,s){var r,o,h,u,c,a,l,k=t+"_BlockMatcher";if(!s[k]){for(u=[],c=[],r=K(e),o=0,h=r.length;h>o;o++)a=ee(k+"_0_"+o,Z(r[o][0],n,i),o,s),l=r[o].length>1?ee(k+"_1_"+o,Z(r[o][1],n,i),o,s):a,u.push(a),c.push(l);s[k]=new se(k,u,c)}return s[k]},oe=G(Object,{constructor:function(t,e,n,i){t&&(this.name=t),e&&(this.token=e),n&&(this.type=n),i&&(this.style=i),this.tokenName=this.name},name:null,token:null,tokenName:null,type:null,style:null,isRequired:!1,ERROR:!1,streamPos:null,stackPos:null,actionBefore:null,actionAfter:null,toString:function(){var t="[";return t+="Tokenizer: "+this.name,t+=", Type: "+this.type,t+=", Token: "+(this.token?this.token.toString():null),t+="]"},required:function(t){return this.isRequired=t?!0:!1,this},backTrack:function(t){return t.pos-=t.pos-this.streamPos,this},pushToken:function(t,e,n){return this.stackPos?t.splice(this.stackPos+(n||0),0,e):t.push(e),this},clone:function(){var t=_.call(arguments);if(t.length){var e=t.shift(),n=t.length,i=new e;i.name=this.name,i.type=this.type,i.isRequired=this.isRequired,i.ERROR=this.ERROR,i.actionBefore=this.actionBefore,i.actionAfter=this.actionAfter;for(var s=0;n>s;s++)i[t[s]]=this[t[s]];return i}return null},test:function(t){return this.token.test(t)},tokenize:function(t,e){return this.token.match(t)?(e.currentToken=this.type,this.style):!1}}),he=G(oe,{constructor:function(t,e,n,i,s){t&&(this.name=t),e&&(this.token=e),n&&(this.type=n),i&&(this.style=i),this.multiline=!1!==s,this.endBlock=null,this.tokenName=this.name},multiline:!1,endBlock:null,tokenize:function(t,e){var n=!1,i=!1;if(e.inBlock==this.name?(i=!0,this.endBlock=e.endBlock):!e.inBlock&&(this.endBlock=this.token.match(t))&&(i=!0,e.inBlock=this.name,e.endBlock=this.endBlock),i){for(this.stackPos=e.stack.length,n=this.endBlock.match(t);!n&&!t.eol();){if(this.endBlock.match(t)){n=!0;break}t.next()}return n=n||!this.multiline&&t.eol(),n?(e.inBlock=null,e.endBlock=null):this.pushToken(e.stack,this),e.currentToken=this.type,this.style}return e.inBlock=null,e.endBlock=null,!1}}),ue=G(he,{constructor:function(t,e,n,i,s,r){t&&(this.name=t),e&&(this.token=e),n&&(this.type=n),i&&(this.style=i),s&&(this.escape=s||"\\"),r&&(this.multiline=r||!1),this.endBlock=null,this.isEscaped=!1,this.tokenName=this.name},escape:"\\",tokenize:function(t,e){var n="",i=!1,s=!1,r=!1;if(e.inBlock==this.name?(s=!0,this.endBlock=e.endBlock):!e.inBlock&&(this.endBlock=this.token.match(t))&&(s=!0,e.inBlock=this.name,e.endBlock=this.endBlock),s){for(e.inBlock=this.name,this.stackPos=e.stack.length,i=this.endBlock.match(t);!i&&!t.eol();){if(!r&&this.endBlock.match(t)){i=!0;break}n=t.next(),r=!r&&n==this.escape}return i=i||!(r&&this.multiline),i?(e.inBlock=null,e.endBlock=null):this.pushToken(e.stack,this),e.currentToken=this.type,this.style}return e.inBlock=null,e.endBlock=null,!1}}),ce=G(oe,{constructor:function(t,e){t&&(this.name=t),e&&(this.type=e),this.tokenName=this.name},tokens:null,buildTokens:function(t){return t&&(this.tokens=D(t),this.token=this.tokens[0]),this}}),ae=G(ce,{constructor:function(t,e){this.type=A,t&&(this.name=t),e&&this.buildTokens(e),this.tokenName=this.name},test:function(t){return this.token.test(t)},tokenize:function(t,e){this.isRequired=!1,this.ERROR=!1,this.streamPos=t.pos;var n=this.token.tokenize(t,e);return token.ERROR&&this.backTrack(t),n}}),le=G(ce,{constructor:function(t,e){this.type=P,t&&(this.name=t),e&&this.buildTokens(e),this.tokenName=this.name},test:function(t){for(var e,n=0,i=this.tokens.length;i>n;n++)if(e=this.tokens[n].test(t))return!0;return!1},tokenize:function(t,e,n){var i,s,r,o=this.tokens.length,h=0;for(this.isRequired=!1,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,i=0;o>i;i++){if(s=this.tokens[i],r=s.tokenize(t,e,n),!1!==r)return this.pushToken(e.stack,this),r;s.ERROR&&(h++,this.backTrack(t))}return!1}}),ke=G(ce,{constructor:function(t,e){this.type=q,t&&(this.name=t),e&&this.buildTokens(e),this.foundOne=!1,this.tokenName=this.name},foundOne:!1,test:function(t){for(var e,n=0,i=this.tokens.length;i>n;n++)if(e=this.tokens[n].test(t))return!0;return!1},tokenize:function(t,e,n){var i,s,r,o=this.tokens.length,h=0,u=0;for(this.isRequired=!this.foundOne,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,r=0;o>r;r++){if(s=this.tokens[r],i=s.tokenize(t,e,n),h+=s.isRequired?1:0,!1!==i)return this.foundOne=!0,this.isRequired=!1,this.ERROR=!1,this.pushToken(e.stack,this.clone(ke,"tokens","foundOne")),this.foundOne=!1,i;s.ERROR&&(u++,this.backTrack(t))}return this.ERROR=this.foundOne?!1:!0,!1}}),pe=G(ce,{constructor:function(t,e){this.type=x,t&&(this.name=t),e&&this.buildTokens(e),this.tokenName=this.name},test:function(t){for(var e,n=0,i=this.tokens.length;i>n;n++)if(e=this.tokens[n].test(t))return!0;return!1},tokenize:function(t,e,n){var i,s,r,o=this.tokens.length,h=0,u=0;for(this.isRequired=!0,this.ERROR=!1,this.streamPos=t.pos,r=0;o>r;r++){if(s=this.tokens[r],i=s.tokenize(t,e,n),h+=s.isRequired?1:0,!1!==i)return i;s.ERROR&&(u++,this.backTrack(t))}return this.isRequired=h>0?!0:!1,this.ERROR=o==u&&h>0?!0:!1,!1}}),fe=G(ce,{constructor:function(t,e){this.type=w,t&&(this.name=t),e&&this.buildTokens(e),this.tokenName=this.name},test:function(t){return this.tokens[this.tokens.length-1].test(t)},tokenize:function(t,e,n){var i,s,r=this.tokens.length,o=!1,h=0;if(this.isRequired=!0,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,i=this.tokens[0],s=i.required(!0).tokenize(t,e,n),!1!==s){this.stackPos=e.stack.length;for(var u=r-1;u>0;u--)this.pushToken(e.stack,this.tokens[u].required(!0),r-u+h);o=s}else i.ERROR?(this.ERROR=!0,this.backTrack(t)):i.isRequired&&(this.ERROR=!0);return o}}),me=G(ce,{constructor:function(t,e){this.type=S,t&&(this.name=t),e&&this.buildTokens(e),this.tokenName=this.tokens[0].name},test:function(t){return this.tokens[this.tokens.length-1].test(t)},tokenize:function(t,e,n){var i,s,r=this.tokens.length,o=!1,h=0;if(this.isRequired=!1,this.ERROR=!1,this.streamPos=t.pos,this.stackPos=e.stack.length,i=this.tokens[0],s=i.required(!1).tokenize(t,e,n),!1!==s){this.stackPos=e.stack.length;for(var u=r-1;u>0;u--)this.pushToken(e.stack,this.tokens[u].required(!0),r-u+h);o=s}else i.ERROR&&this.backTrack(t);return o}}),ge=function(t,e,n,i,s,r,o,h,u){var c,a,l,k,p,f=null;if(!u[t]){if(c=i[t]||s[t]||null)if(a=c.type||"simple",a=L[a.toUpperCase()],p=c.action||null,T==a)f=new he(t,re(t,c.tokens.slice(),e,o,h),a,r[t]||"invisible",c.multiline);else if(B==a)f=new ue(t,re(t,c.tokens.slice(),e,o,h),a,r[t]||"invisible",c.escape||"\\",c.multiline||!1);else if(b==a)f=new oe(t,ie(t,c.tokens.slice(),e,n[t],o,h),a,r[t]||"invisible");else if(N==a){l=z[c.match.toUpperCase()],k=D(c.tokens).slice();for(var m=0,g=k.length;g>m;m++)k[m]=ge(k[m],e,n,i,s,r,o,h,u);f=A==l?new ae(t,k):P==l?new le(t,k):q==l?new ke(t,k):x==l?new pe(t,k):new fe(t,k)}else if(S==a){f=K(D(c.tokens).slice()).slice();for(var m=0,g=f.length;g>m;m++){for(var R=f[m],d=0,y=R.length;y>d;d++)R[d]=ge(R[d],e,n,i,s,r,o,h,u);f[m]=new me(t+"_NGRAM_"+m,R)}}u[t]=f}return u[t]},Re=G(Object,{constructor:function(t){this.string=t,this.pos=this.start=0},string:"",start:0,pos:0,eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(t){var e=this.string.charAt(this.pos);if("string"==typeof t)var n=e==t;else var n=e&&(t.test?t.test(e):t(e));return n?(++this.pos,e):void 0},eatWhile:function(t){for(var e=this.pos;this.eat(t););return this.pos>e},eatSpace:function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},current:function(){var t=this.string.slice(this.start,this.pos);return this.start=this.pos,t}}),de=function(t,e){var n={getLineTokens:function(){var n=e.DEFAULT,i=t.Style||{},s=i.error||null,r=t.Parser||[],o=r.length;return function(t,i){var h,u,c,a,l=[],k=new Re(t);for(i=i||{},a=i.stack=i.stack||[];!k.eol();)if(k.eatSpace())i.current=null,i.currentToken=E;else{for(;a.length;)if(u=a.pop(),c=u.tokenize(k,i,e),!1===c){if(!u.ERROR&&!u.isRequired)continue;i.stack.length=0,k.next(),i.current=null,i.currentToken=O,l.push({type:s,value:k.current()})}else i.current=u.tokenName,l.push({type:c,value:k.current()});for(h=0;o>h;h++)if(u=r[h],c=u.tokenize(k,i,e),!1===c){if(!u.ERROR&&!u.isRequired)continue;i.stack.length=0,k.next(),i.current=null,i.currentToken=O,l.push({type:s,value:k.current()})}else i.current=u.tokenName,l.push({type:c,value:k.current()});k.next(),i.current=null,i.currentToken=E,l.push({type:n,value:k.current()})}return{state:i,tokens:l}}}()};return n},ye=function(t){var e,n,i,s,r,o,h,u,a,l,k,p={},f={},m={};if(t.__parsed)return t;for(t=U(t,ve),e=t.RegExpID||null,t.RegExpID=null,delete t.RegExpID,n=t.RegExpGroups||{},t.RegExpGroups=null,delete t.RegExpGroups,h=t.Lex||{},t.Lex=null,delete t.Lex,u=t.Syntax||{},t.Syntax=null,delete t.Syntax,o=t.Style||{},r=t.Parser||[],s=r.length,i=[],a=0;s>a;a++)l=r[a],k=ge(l,e,n,h,u,o,p,f,m)||null,k&&(c==I(k)?i=i.concat(k):i.push(k));return t.Parser=i,t.Style=o,t.__parsed=!0,t},ve={RegExpID:null,RegExpGroups:null,Style:{error:"error"},Lex:null,Syntax:null,Parser:null},Oe={VERSION:i,init:function(t){n=t},extend:U,parse:ye,getMode:function(t,e){t=ye(t);var n,i,s={DEFAULT:e||"invisible"};return n=de(t,s),i={getTokenizer:function(){return function(){return n}}(),HighlightRules:null,$behaviour:null,lineCommentStart:"",blockComment:"",toggleCommentLines:function(){return!1},toggleBlockComment:function(){},getNextLineIndent:function(t,e){return e.match(/^\s*/)[0]},checkOutdent:function(){return!1},autoOutdent:function(){},$getIndent:function(t){return t.match(/^\s*/)[0]},createWorker:function(){return null},createModeDelegates:function(){},$delegator:function(){},transformAction:function(){},getKeywords:function(){return[]},$createKeywordList:function(){return[]},getCompletions:function(){return[]}}}};"undefined"!=typeof module&&module.exports?module.exports=Oe:"undefined"!=typeof exports?exports=Oe:this.AceGrammar=Oe}).call(this);